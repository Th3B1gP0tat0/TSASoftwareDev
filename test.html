<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required Scripts -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined&icon_names=group_add,group_remove,palette,settings&display=block" rel="stylesheet" />
    <title>Friends</title>
    <link rel="stylesheet" href="stylesheet.css" />
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
    <script>
      const supabaseUrl = "https://gcrezomlzfcymopehdhu.supabase.co";
      const supabaseKey =
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdjcmV6b21semZjeW1vcGVoZGh1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDI0MjE1MjMsImV4cCI6MjA1Nzk5NzUyM30.mwqO1LaHtSy4dLg0U-YqY1yjNLms4QFjcY6k689eBZY";
      window.supabase = supabase.createClient(supabaseUrl, supabaseKey);
    </script>
  </head>
  <body>
    <header style="background-color: rgb(49, 54, 78);">
      <!-- Adding tabs to the navigation bar -->
      <nav>
        <ul class="nav-list" style="display: flex; list-style: none; padding: 10px; margin: 10px 5;">
          <li class="nav-item" style="margin: 5 500px;"><a class="nav-header" style="color: #f0f1de; text-decoration: none; font-size: 1.2rem;">EcoTrack</a></li>
          <li class="nav-item" style="margin: 5 20px;"><a href="homepage.html" class="nav-link" style="color: #f0f1de; text-decoration: none; font-size: 1rem;">Home</a></li>
          <li class="nav-item" style="margin: 5 20px;"><a href="stats.html" class="nav-link" style="color: #f0f1de; text-decoration: none; font-size: 1rem;">Your Statistics</a></li>
          <li class="nav-item" style="margin: 5 20px;"><a href="leaderboard.html" class="nav-link" style="color: #f0f1de; text-decoration: none; font-size: 1rem;">Community Leaderboard</a></li>
          <li class="nav-item" style="margin: 5 20px;"><a href="friends.html" class="nav-link" style="color: #f0f1de; text-decoration: none; font-size: 1rem;">Friends</a></li>
        </ul>
      </nav>
    </header>

    <body>
      <div style="display: flex; justify-content: right; align-items: center; gap: 20px; margin-right: 20px;">
        <div id="root"></div>
        <div id="root1"></div>
      </div>

      <div id="friends-list-container" style="margin: 30px;"></div>

      <script type="text/babel">
        async function fetchFriends(userId) {
          const { data, error } = await window.supabase
            .from("friends")
            .select("friend_name")
            .eq("user_id", userId);

          if (error) {
            console.error("Error fetching friends:", error);
            return [];
          }
          return data.map((friend) => friend.friend_name);
        }

        async function addFriend(userId, friendName) {
          const { error } = await window.supabase
            .from("friends")
            .insert([{ user_id: userId, friend_name: friendName }]);
          if (error) console.error("Error adding friend:", error);
        }

        async function removeFriend(userId, friendName) {
          const { error } = await window.supabase
            .from("friends")
            .delete()
            .eq("user_id", userId)
            .eq("friend_name", friendName);
          if (error) console.error("Error removing friend:", error);
        }

        function FriendsList({ friends }) {
          return (
            <div style={{ textAlign: "center", marginTop: "20px" }}>
              <table style={{ margin: "0 auto", border: "1px solid #f0f1de", color: "white" }}>
                <thead>
                  <tr>
                    <th style={{ padding: "10px", border: "1px solid #f0f1de" }}>Friend Name</th>
                  </tr>
                </thead>
                <tbody>
                  {friends.length > 0 ? (
                    friends.map((friend, index) => (
                      <tr key={index}>
                        <td style={{ padding: "10px", border: "1px solid #f0f1de" }}>{friend}</td>
                      </tr>
                    ))
                  ) : (
                    <tr>
                      <td style={{ padding: "10px", border: "1px solid #f0f1de" }}>No friends found</td>
                    </tr>
                  )}
                </tbody>
              </table>
            </div>
          );
        }

        function App() {
          const [friends, setFriends] = React.useState([]);
          const userId = "CURRENT_USER_ID"; // Replace with the actual user ID.

          React.useEffect(() => {
            fetchFriends(userId).then(setFriends);
          }, []);

          return (
            <div>
              <FriendsList friends={friends} />
            </div>
          );
        }

        ReactDOM.createRoot(document.getElementById("friends-list-container")).render(<App />);
      </script>
    </body>
  </body>
</html>
